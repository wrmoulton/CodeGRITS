# CodeGRITS XML Preview Feature

## Overview

The XML Preview feature provides an in-IDE interface for viewing and analyzing XML output generated by CodeGRITS tracking. This feature allows researchers to quickly inspect IDE interaction data, eye-tracking data, and related metadata without leaving the IDE.

## Components

### 1. XMLPreviewPanel (`components/XMLPreviewPanel.java`)
A reusable Swing panel component that displays XML content with the following features:
- **Syntax highlighting** for improved readability
- **Auto-formatting** with proper indentation
- **Copy to clipboard** functionality
- **Line counting** for tracking data size
- **Status bar** showing current content information

**Usage:**
```java
XMLPreviewPanel panel = new XMLPreviewPanel();
Document xmlDoc = // your XML document
panel.displayDocument(xmlDoc);
```

### 2. XMLPreviewWindow (`components/XMLPreviewWindow.java`)
A dialog window providing a dedicated interface for XML preview with:
- **Tabbed interface** for IDE Tracking, Eye Tracking, and Combined View
- **Resizable and modeless** design
- **Support for both Document and String** display modes

**Usage:**
```java
XMLPreviewWindow window = new XMLPreviewWindow(project);
window.displayIDETrackingXML(document);
window.show();
```

### 3. XMLValidator (`utils/XMLValidator.java`)
Utility class for XML operations:
- **File validation** - Check if XML files are well-formed
- **XML parsing** - Convert files or strings to Document objects
- **String conversion** - Format or convert Document objects to strings
- **Error reporting** - Detailed error messages for debugging

**Key Methods:**
- `validateXMLFile(String filePath)` - Check if file is valid
- `parseXMLFile(String filePath)` - Parse file to Document
- `parseXMLString(String xmlString)` - Parse string to Document
- `documentToFormattedString(Document)` - Pretty-print XML
- `isValidXML(String xmlString)` - Validate XML string

### 4. XMLPreviewAction (`actions/XMLPreviewAction.java`)
Action class that opens the XML preview dialog from the Tools menu.
- Opens as a modeless dialog
- Can be accessed from `Tools → XML Preview`

### 5. XMLFilePreviewPanel (`components/XMLFilePreviewPanel.java`)
Extended preview panel with file browsing capabilities:
- **File browser** dialog for selecting XML files
- **Automatic loading** of selected files
- **Error handling** with user-friendly messages

### 6. XMLStatusWidget (`components/XMLStatusWidget.java`)
Status bar widget for real-time tracking information:
- Displays current XML element counts
- Shows tracking status
- Click to open quick preview popup

### 7. XMLPreviewDataHandler (`api/XMLPreviewDataHandler.java`)
Singleton manager for XML preview updates:
- Receives updates from trackers
- Manages preview widget state
- Provides current document access
- Singleton pattern for IDE-wide access

## Integration Points

### With IDETracker
The XMLPreviewDataHandler can be integrated with IDETracker to receive real-time updates:

```java
XMLPreviewDataHandler handler = XMLPreviewDataHandler.getInstance();
handler.initialize(project);
handler.onIDETrackingUpdate(iDETracking);
```

### With EyeTracker
Similar integration for eye tracking data:

```java
XMLPreviewDataHandler handler = XMLPreviewDataHandler.getInstance();
handler.onEyeTrackingUpdate(eyeTracking);
```

### Plugin Configuration
Added to `plugin.xml`:
```xml
<action id="CodeGRITS.XMLPreview" class="actions.XMLPreviewAction" 
        text="XML Preview" description="Preview CodeGRITS XML output">
    <add-to-group group-id="ToolsMenu" anchor="after" relative-to-action="CodeGRITS.Config"/>
</action>
```

## Usage Guide

### Opening XML Preview
1. Go to `Tools` menu in the IDE
2. Click `XML Preview`
3. A preview window will open with tabs for different data types

### Browsing XML Files
1. Click `Browse XML File` button
2. Select an XML file from the file dialog
3. The file will be automatically parsed and displayed

### Viewing Real-Time Data
1. Start tracking with CodeGRITS
2. The status bar widget will show element counts
3. Click the widget to see quick preview

### Formatting XML
1. Use the `Auto-Format` button to pretty-print XML
2. View formatted output with proper indentation
3. Use `Copy` to copy formatted output to clipboard

## Features

### Multi-Format Support
- Display Document objects (DOM trees)
- Display XML strings
- Display file content directly

### Real-Time Updates
- Live tracking status in status bar
- Quick preview popups
- Element count updates

### Data Export
- Copy XML to clipboard
- Copy formatted XML
- Export to external viewers

### Error Handling
- Validation of XML well-formedness
- Detailed error messages
- Graceful degradation

## Technical Details

### XML Formatting
XML is formatted with:
- 2-space indentation
- Proper line breaks
- UTF-8 encoding
- XML declaration

### Performance Considerations
- Async loading of large files
- Efficient DOM parsing
- Cached document references
- Lazy widget creation

### Integration Architecture
```
IDETracker/EyeTracker
    ↓
XMLPreviewDataHandler (Singleton)
    ↓
├─ XMLStatusWidget (Status Bar)
├─ XMLPreviewWindow (Dialog)
└─ XMLPreviewPanel (Reusable Component)
```

## Future Enhancements

Potential improvements for the XML preview feature:
1. **Syntax highlighting** with color coding
2. **XML validation** with schema support
3. **XPath queries** for searching elements
4. **Diff view** for comparing two XML files
5. **Performance metrics** (file size, element count)
6. **Export options** (CSV, JSON, custom formats)
7. **Real-time streaming** display for large files
8. **Tree view** for hierarchical navigation

## API Reference

### XMLPreviewPanel
```java
public class XMLPreviewPanel extends JPanel {
    public void displayDocument(Document document)
    public void displayXMLString(String xmlString)
    public String getXMLText()
    public void clear()
}
```

### XMLPreviewWindow
```java
public class XMLPreviewWindow extends DialogWrapper {
    public void displayIDETrackingXML(Document document)
    public void displayEyeTrackingXML(Document document)
    public void displayCombinedXML(String xmlString)
    public XMLPreviewPanel getIDETrackingPanel()
    public XMLPreviewPanel getEyeTrackingPanel()
    public void clearAll()
}
```

### XMLValidator
```java
public class XMLValidator {
    public static boolean validateXMLFile(String filePath)
    public static Document parseXMLFile(String filePath)
    public static Document parseXMLString(String xmlString)
    public static String documentToFormattedString(Document document)
    public static String documentToString(Document document)
    public static String getValidationErrorMessage(String filePath)
    public static boolean isValidXML(String xmlString)
    public static int getLineCount(Document document)
}
```

### XMLPreviewDataHandler
```java
public class XMLPreviewDataHandler {
    public static XMLPreviewDataHandler getInstance()
    public void initialize(Project project)
    public void onIDETrackingUpdate(Document document)
    public void onEyeTrackingUpdate(Document document)
    public void onIDEElementAdded(Element element)
    public Document getCurrentIDEDocument()
    public Document getCurrentEyeDocument()
    public void reset()
    public void setStatusWidget(XMLStatusWidget widget)
}
```

## Example Usage

### Basic Preview
```java
XMLPreviewPanel panel = new XMLPreviewPanel();
Document doc = XMLValidator.parseXMLFile("/path/to/ide_tracking.xml");
panel.displayDocument(doc);
```

### Window Preview
```java
XMLPreviewWindow window = new XMLPreviewWindow(project);
Document ideDoc = XMLValidator.parseXMLFile(ideTrackingPath);
window.displayIDETrackingXML(ideDoc);
window.show();
```

### Real-Time Tracking
```java
XMLPreviewDataHandler handler = XMLPreviewDataHandler.getInstance();
handler.initialize(project);

// During tracking updates
Document updatedDoc = // get updated document
handler.onIDETrackingUpdate(updatedDoc);
```

## Troubleshooting

### XML not displaying
- Verify the XML file exists and is accessible
- Check if XML is well-formed (use XMLValidator)
- Look for error messages in the status bar

### Preview window not opening
- Ensure project is open
- Check IDE console for exceptions
- Verify plugin is properly loaded

### Performance issues with large files
- XML files > 100MB may be slow to parse
- Use external XML viewer for very large files
- Consider splitting large tracking sessions

